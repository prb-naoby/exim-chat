services:
  exim-chat:
    image: ghcr.io/prb-naoby/exim-chat:latest
    container_name: exim-chat
    ports:
      - "8504:8504"
    volumes:
      - exim_data:/app/data
      - ./logs:/app/logs
    environment:
      - REDIS_HOST=${REDIS_HOST}
      - REDIS_PORT=${REDIS_PORT}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - APP_PASSWORD=${APP_PASSWORD}
      - INSW_QDRANT_URL=${INSW_QDRANT_URL}
      - INSW_QDRANT_API_KEY=${INSW_QDRANT_API_KEY}
      - INSW_QDRANT_COLLECTION_NAME=${INSW_QDRANT_COLLECTION_NAME}
      - SOP_QDRANT_URL=${SOP_QDRANT_URL}
      - SOP_QDRANT_API_KEY=${SOP_QDRANT_API_KEY}
      - SOP_QDRANT_COLLECTION_NAME=${SOP_QDRANT_COLLECTION_NAME}
      - CASES_QDRANT_COLLECTION_NAME=${CASES_QDRANT_COLLECTION_NAME}
      - CONFIDENCE_THRESHOLD=${CONFIDENCE_THRESHOLD}
      - LLM_MODEL=${LLM_MODEL}
      - SOP_FOLDER_PATH=${SOP_FOLDER_PATH}
      - INSW_SOP_FOLDER_PATH=${INSW_SOP_FOLDER_PATH}
      - CASES_FOLDER_PATH=${CASES_FOLDER_PATH}
      # OneDrive Config
      - ONEDRIVE_DRIVE_ID=${ONEDRIVE_DRIVE_ID}
      - MS_TENANT_ID=${MS_TENANT_ID}
      - MS_CLIENT_ID=${MS_CLIENT_ID}
      - MS_CLIENT_SECRET=${MS_CLIENT_SECRET}
    networks:
      - default
      - redis
      - nginx-network
    restart: unless-stopped

volumes:
  exim_data:


networks:
  default:
    name: exim_network
  redis:
    external: true
  nginx-network:
    external: true
