services:
  exim-chat:
    image: ghcr.io/prb-naoby/exim-chat:latest
    container_name: exim-chat
    ports:
      - "3000:3000"
    environment:
      - MODE=frontend
      - NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL:-http://exim-chat-backend:3333}
      - TZ=Asia/Jakarta
    networks:
      - default
    depends_on:
      - exim-chat-backend
    restart: unless-stopped

  exim-chat-backend:
    image: ghcr.io/prb-naoby/exim-chat:latest
    container_name: exim-chat-backend
    ports:
      - "3333:3333"
    volumes:
      - exim_data:/app/data
      - exim_logs:/app/logs
    environment:
      - MODE=backend
      # Redis Config
      - REDIS_HOST=${REDIS_HOST}
      - REDIS_PORT=${REDIS_PORT}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      # API Keys
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - APP_PASSWORD=${APP_PASSWORD}
      # Qdrant Configuration
      - INSW_QDRANT_URL=${INSW_QDRANT_URL}
      - INSW_QDRANT_API_KEY=${INSW_QDRANT_API_KEY}
      - INSW_QDRANT_COLLECTION_NAME=${INSW_QDRANT_COLLECTION_NAME}
      - SOP_QDRANT_URL=${SOP_QDRANT_URL}
      - SOP_QDRANT_API_KEY=${SOP_QDRANT_API_KEY}
      - SOP_QDRANT_COLLECTION_NAME=${SOP_QDRANT_COLLECTION_NAME}
      - CASES_QDRANT_URL=${CASES_QDRANT_URL}
      - CASES_QDRANT_API_KEY=${CASES_QDRANT_API_KEY}
      - CASES_QDRANT_COLLECTION_NAME=${CASES_QDRANT_COLLECTION_NAME}
      - GENERAL_QDRANT_COLLECTION_NAME=${GENERAL_QDRANT_COLLECTION_NAME}
      - CONFIDENCE_THRESHOLD=${CONFIDENCE_THRESHOLD}
      # LLM Config
      - LLM_MODEL=${LLM_MODEL}
      - EMBEDDING_MODEL=${EMBEDDING_MODEL}
      - VECTOR_SIZE=${VECTOR_SIZE}
      # OneDrive Config
      - ONEDRIVE_DRIVE_ID=${ONEDRIVE_DRIVE_ID}
      - MS_TENANT_ID=${MS_TENANT_ID}
      - MS_CLIENT_ID=${MS_CLIENT_ID}
      - MS_CLIENT_SECRET=${MS_CLIENT_SECRET}
      # Folder Paths
      - SOP_FOLDER_PATH=${SOP_FOLDER_PATH}
      - INSW_FOLDER_PATH=${INSW_FOLDER_PATH}
      - CASES_FOLDER_PATH=${CASES_FOLDER_PATH}
      - GENERAL_FOLDER_PATH=${GENERAL_FOLDER_PATH}
      # Security
      - JWT_SECRET_KEY=${JWT_SECRET_KEY}
      # Timezone
      - TZ=Asia/Jakarta
    networks:
      - default
      - redis
      - nginx-network
    restart: unless-stopped

volumes:
  exim_data:
  exim_logs:


networks:
  default:
    name: exim_network
  redis:
    external: true
  nginx-network:
    external: true
